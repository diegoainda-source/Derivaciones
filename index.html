<!doctype html>
<html lang="es">
<head>
  <meta name="author" content="Dr. Diego Alejandro Inda Álamos">
  <meta name="description" content="Guía interactiva creada por el Dr. Diego Alejandro Inda Álamos para la derivación odontológica.">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GUÍA INTERACTIVA DE DERIVACIÓN</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#F58220" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="splash" aria-hidden="true">
    <img src="icons/logo-white.png" alt="Logo Odontología" class="logo" />
    <div class="brand">Hospital Gustavo Fricke</div>
  </div>
  <div class="card">
    <h1 class="titulo app-title">DERIVACIÓN ESPECIALIDADES ODONTOLÓGICAS</h1>
    <div id="main"></div>
  </div>
  
  <!-- Botón de reiniciar siempre visible -->
  <button class="btn btn-reset" onclick="reset()" style="display: none;"><span style="font-size: 22px;">⟲</span> Reiniciar</button>
  
  <script>
  // Mostrar botón de reiniciar después del splash
  setTimeout(() => {
    const resetBtn = document.querySelector('.btn-reset');
    if (resetBtn && !document.body.classList.contains('intro-bg')) {
      resetBtn.style.display = 'flex';
    }
  }, 1800);
  </script>
  
  <!-- Registro del Service Worker -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', async () => {
    try {
      const reg = await navigator.serviceWorker.register('/service-worker.js', { updateViaCache: 'none' });
      if (reg.waiting) reg.waiting.postMessage({ type: 'SKIP_WAITING' });

      reg.addEventListener('updatefound', () => {
        const sw = reg.installing;
        sw?.addEventListener('statechange', () => {
          if (sw.state === 'installed' && navigator.serviceWorker.controller) {
            sw.postMessage({ type: 'SKIP_WAITING' });
            location.reload(); // recarga cuando hay nueva versión
          }
        });
      });
    } catch (e) { console.error('Error registrando SW', e); }
  });
}
</script>
<footer id="app-footer" class="app-footer">
  Aplicación creada por <strong>Dr. Diego Inda Álamos</strong>
</footer>
<script src="script.js"></script>
<!-- Protección frente a copia, excepto en páginas de derivar -->
<style>
  .no-copy {
    user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
  }
</style>

<script>
function activarProteccion() {
  // Revisa si la pantalla actual tiene texto "DERIVAR"
  const contieneDerivar = document.body.innerText.includes("Derivación") || document.body.innerText.includes("derivación") || document.body.innerText.includes("DERIVAR");
  
  if (!contieneDerivar) {
    // Activar bloqueo de clic derecho y combinaciones de copia
    document.addEventListener('contextmenu', bloquearContexto);
    document.addEventListener('keydown', bloquearAtajos);
    document.body.classList.add("no-copy");
  } else {
    // Quitar bloqueo si se trata de página de derivación
    document.removeEventListener('contextmenu', bloquearContexto);
    document.removeEventListener('keydown', bloquearAtajos);
    document.body.classList.remove("no-copy");
  }
}

function bloquearContexto(e) {
  e.preventDefault();
}

function bloquearAtajos(e) {
  if ((e.ctrlKey || e.metaKey) && ['u', 's', 'p', 'c'].includes(e.key.toLowerCase())) e.preventDefault();
  if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'i')) e.preventDefault();
}

// Activar al cargar y cada vez que cambie el contenido (observador dinámico)
window.addEventListener('load', activarProteccion);
const observador = new MutationObserver(activarProteccion);
observador.observe(document.body, { childList: true, subtree: true });
</script>
</body>
</html>
